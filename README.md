## Projenin Kurulması ve İşleyişi 
</br>
Proje için bir Arduino Uno, bir USB Type-B kablosu, bir HC-06, bir 3.5 inç TFT LCD Ekran Shield’ı, 20 tane dişi-erkek jumper kablo ve bir bilgisayar gereklidir. </br>
Yazılımı yazmak için işletim sistemi yüklü bir bilgisayara Arduino IDE programının yüklenmesi gereklidir. </br>
Devreyi kurmak için Arduino Uno’nun ve LED Display’in ekran kısmının, LED Display’in SD Kart kısmının ve Arduino Uno’nun USB bağlantı kısmının aynı yöne baktığından emin olarak LCD ekran kartının 5V, GND ve 3V pinlerini Arduino Uno’nun aynı pinleri ile üst üste hizalayınız. LCD ekranın dijital pinlerinin Arduino Uno’nun dijital pinleri ile denk geldiğinden emin olunuz ve ekranın şu pinlerini, hemen altındaki Arduino’nun denk gelen pinlerine bağlayınız: LCD_RST, LCD_CS, LCD_RS, LCD_WR, LCD_RD, GND, 5V, 3V3, LCD_D2, LCD_D3, LCD_D4, LCD_D5, LCD_D6, LCD_D7, LCD_D0, LCD_D1. Ayrıca HC-06’nın VCC pinini Arduino’nun diğer 5V pinine, GND pinini GND pinine, RXD pinini D11 pinine, TXD pinini D10 pinine bağlayınız. </br>
Devrenin kodunu yazmadan önce Adafruit GFX ve MCUFRIEND_kbv kütüphanelerinin yüklenmesi gerekmektedir. Adafruit GFX kütüphanesini kurmak için Arduino IDE yazılımının üst kısmındaki “Araçlar” sekmesinden “Araçlar > Kütüphaneleri Yönet” sekmesine geliniz ve açılan sekmede arama çubuğuna “Adafruit GFX” yazıp aratınız. “Adafruit GFX Library” adlı, “Adafruit” tarafından paylaşılmış olan kütüphaneyi, hemen yanındaki “Kur” düğmesinden indirip kurunuz. MCUFRIEND_kbv kütüphanesini kurmak için https://github.com/slviajero/MCUFRIEND_kbv bağlantısına tıklayınız ve açılan internet sayfasında yeşil renkli “Code” yazılı düğmeyi bulunuz. Bu düğmeye tıklayınız ve açılan sekmede “Download ZIP” seçeneği ile kütüphaneyi indiriniz. Daha sonra Arduino IDE yazılımına gelip üst kısımdaki “Eskiz” sekmesinden “Eskiz > Kütüphane Ekle > .ZIP Kütüphanesi Ekle” sekmesine geliniz ve açılan pencereden henüz indirdiğiniz “MCUFRIEND_kbv-master.zip” dosyasını seçip kütüphaneyi kurunuz. Bütün kütüphaneler kurulunca, bu klasörün içindeki marmaraykoltuksayaci.ino dosyasını açınız ve Arduino Uno kartınızı USB bağlantı kablosu aracılığı ile bilgisayarınıza bağlayınız. Kartınızın bağlı olduğundan emin olduktan sonra “Araçlar > Port” kısmından kartınızın bağlı bulunduğu port’u seçiniz. Daha sonra menülerin hemen altındaki düğmelerden soldan ikinci olanına tıklayarak kodun kartınıza yüklenmesini başlatınız. Bu işlem önce kodunuzu derleyecek, daha sonra da kartınıza yükleyecektir. </br>
Yazdığımız kod vasıtası ile Arduino-Telefon arası bağlantı protokolü geliştirilmiştir. Bu protokole göre cihaz, Bluetooth aracılığıyla HC-06 ile eşleştirilir ve bağlantı sağlandığında HC-06, “<STATUS INIT>” şeklinde (tırnak işaretleri olmadan) bir bilgi gönderir. Cihaz, bağlantının kurulduğunu belirtmek için “<STATUS OK>” şeklinde cevap verir. Daha sonra HC-06, durak bilgilerini istemek için “<GET BOARDINGSTATIONNAME>” şeklinde bir istek gönderir. Cihaz, bu istekten sonra binilen durak adını “<durakadi>” şeklinde Türkçe karakterler olmadan verir. Örneğin: “<Kucukyali>”. Verilen bilgiden sonra HC-06, inilecek durak adını istemek için cihaza “<GET ARRIVALSTATIONNAME>” seklinde bir istek gönderir. Cihaz, bu istekten sonra inilecek durak adını “<durakadi>” şeklinde Türkçe karakter olmadan verir. Örneğin: “<Halkali>”. Bu bilgiden sonra HC-06, gidilecek toplam durak sayısını “<GET STATIONCOUNT>” şeklinde cihazdan ister. Cihaz, bu isteğe karşılık durak sayısını “<durak_sayisi>” şeklinde ister. Örneğin: “<22>”. Bu haberleşmeden sonra HC-06, durağa varıp varılmadığı ile ilgili cihazdan bilgi beklemeye başlar. Cihazdan “<STATION>” değeri alındığında, HC-06 artık kaç durak kaldığı ile ilgili bilgi beklemeye başlar. Cihaz daha sonra “<kalan_durak_sayisi>” şeklinde kaç durak kaldığını haber verir. Örneğin: “<15>”. Eğer gidilecek duraklar bitti ise, yani 0 durak kaldı ise ekran ve HC-06 resetlenir ve cihazın, bağlantıyı bitirmesi beklenir. Aynı zamanda HC-06, protokolü sıfırlayarak en başa döner ve yeni bağlantıları beklemeye başlar. Ayrıca istasyon adları, kalan durak sayısı veya istasyon talimatı gibi durumlar beklenirken “<STATUS OK>” talimatı, cihaz tarafından gönderilir ise HC-06, protokolü sıfırlar ve en başa döner. </br>
Hazırladığımız sistemi test etmek için Android cihazlarda Play Store uygulamasında bulunan “Serial Bluetooth Terminal” uygulaması kullanılabilir, zira ben bu uygulamayı kullanmaktayım. Uygulamayı yükleyip kurunuz ve uygulamaya giriniz. Sol üstteki üç çizgiye tıklayın ve açılan sekmeden “Devices” sekmesine giriniz. Daha sonra telefonu, Bluetooth özelliğini kullanarak HC-06 ile eşleştiriniz. Şifresi varsayılan olarak “1234” veyahut “0000”dır. Eşleştiğinizden eminseniz uygulamaya geri geliniz ve listeden “HC-06”yı bulunuz. Eğer yanında yeşil bir kutucuk var ise üzerine tıklayınız ve terminal ekranını açınız. Devreniz çalışır durumda ise HC-06’ya birkaç saniye içerisinde bağlanacaksınız. Birkaç saniye daha bekleyip Arduino Uno’yu üzerindeki butondan resetleyiniz. Daha sonra Terminal ekranında karşı taraftan “<STATUS INIT>” şeklinde bir bilgi gelecektir. Alttaki metin kutucuğuna “<STATUS OK>” yazarak devam ediniz ve protokole uygun bir şekilde ilerleyiniz. Bağlantıyı kesmek ve yeniden bağlanmak için üstteki sağdan üçüncü düğmeyi kullanınız. </br>
Ertuğrul Çukuryurt tarafından 09.02.2025 tarihinde hazırlanmıştır.
